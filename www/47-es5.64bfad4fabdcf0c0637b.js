!function(){function e(e){return function(e){if(Array.isArray(e))return t(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,n){if(!e)return;if("string"==typeof e)return t(e,n);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return t(e,n)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function n(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function i(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}function r(e,t){return(r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=c(e);if(t){var o=c(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return s(this,n)}}function s(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{"0Hv+":function(e,t,n){"use strict";n.r(t),n.d(t,"ListFieldsPageModule",(function(){return p}));var i,o,r=n("ofXK"),a=n("3Pt+"),s=n("TEn/"),c=n("tyNb"),u=n("fSJy"),d=n("fXoL"),f=[{path:"",component:u.a}],b=((o=function e(){l(this,e)}).\u0275mod=d.Jb({type:o}),o.\u0275inj=d.Ib({factory:function(e){return new(e||o)},imports:[[c.j.forChild(f)],c.j]}),o),p=((i=function e(){l(this,e)}).\u0275mod=d.Jb({type:i}),i.\u0275inj=d.Ib({factory:function(e){return new(e||i)},imports:[[r.b,a.a,s.kb,b]]}),i)},fSJy:function(t,n,r){"use strict";r.d(n,"a",(function(){return S}));var s,c=r("mrSG"),u=r("8xVP"),d=r("9suA"),f=r("4R65"),b=r("fXoL"),p=r("G/jy"),m=r("vuFD"),h=r("TEn/"),v=r("6/gD"),g=r("ofXK"),y=r("3Pt+"),k=((s=function(e){o(n,e);var t=a(n);function n(e,i,o,r,a,s){var c;return l(this,n),(c=t.call(this,s,o)).request=e,c.dialogService=i,c.viewCtrl=o,c.photoService=r,c.newMarker=null,c.modelField=new u.a("Field",e),c.id=a.get("id"),c}return i(n,[{key:"initObject",value:function(){var e=this;console.log("initObject"),this.field={name:"",lat:-27.603857971720405,lng:-55.323644024643414},navigator.geolocation&&navigator.geolocation.getCurrentPosition((function(t){e.field.lat=t.coords.latitude,e.field.lng=t.coords.longitude,console.log("current pos",t)}),(function(e){console.error(e)})),this.id?this.modelField.api_find(this.id).subscribe((function(t){console.log("load field",t),"success"==t.status&&(e.field=t.Field,e.leafletMap(),e.addNewMarker())})):this.leafletMap()}},{key:"submit",value:function(){var e=this;this.field.id?this.modelField.api_update(this.field).subscribe((function(t){var n;"success"==t.status&&(e.dialogService.showToast(null!==(n=t.msjSuccess)&&void 0!==n?n:"Registrado"),e.dismiss(t.Field))})):this.modelField.api_create(this.field).subscribe((function(t){var n;"success"==t.status&&(e.dialogService.showToast(null!==(n=t.msjSuccess)&&void 0!==n?n:"Registrado"),e.dismiss(t.Field))}))}},{key:"dismiss",value:function(e){this.viewCtrl.dismiss({field:e})}},{key:"close",value:function(){this.viewCtrl.dismiss()}},{key:"leafletMap",value:function(){var e=this;this.reset(),this.map=f.map("mapId2"),this.map.on("load",(function(){console.log("load map"),setTimeout((function(){console.log("refresh"),e.regresh()}),1e3)})),this.map.setView([this.field.lat,this.field.lng],11),f.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"futbol8alem.com",id:"mapbox/streets-v11"}).addTo(this.map),this.map.on("contextmenu",(function(t){console.log("rightClick",t),e.field.lat=t.latlng.lat,e.field.lng=t.latlng.lng,e.addNewMarker()})),this.loadFields()}},{key:"addNewMarker",value:function(){var e=this;this.newMarker&&this.map.removeLayer(this.newMarker);var t=f.divIcon({className:"my-custom-pin",iconAnchor:[0,24],labelAnchor:[-6,0],popupAnchor:[0,-36],html:'<span style="\n      background-color: #35da7f;\n      width: 2rem;\n      height: 2rem;\n      display: block;\n      left: -1.5rem;\n      top: -1.5rem;\n      position: relative;\n      border-radius: 3rem 3rem 0;\n      transform: rotate(45deg);\n      border: 1px solid #FFFFFF" />'});this.newMarker=f.marker([this.field.lat,this.field.lng],{draggable:!0,alt:"Nueva Cancha",shadowPane:"Pane",icon:t,title:"Arrastra bara canbiar la ubicaci\xf3n."}).addTo(this.map),this.newMarker.on("dragend",(function(t){var n=t.target,i=n.getLatLng();e.field.lat=i.lat,e.field.lng=i.lng,n.openPopup(),console.log("change pos",e.field)})),this.newMarker.bindPopup(this.field.name,{autoPan:!1}).openPopup()}},{key:"loadFields",value:function(){return Object(c.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.id||this.modelField.api_function("markers").subscribe((function(e){"success"==e.status&&e.data&&e.data.forEach((function(e){t.addMarker(parseFloat(e.lat),parseFloat(e.lng),e.name)})),t.map.setView([t.field.lat,t.field.lng],11)}),(function(e){}));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"addMarker",value:function(e,t,n){var i=f.icon({iconUrl:"http://icons.iconseeker.com/png/fullsize/sport-fields/football-field.png",iconSize:[30,40],iconAnchor:[15,40],shadowSize:[35,50],shadowAnchor:[0,55],popupAnchor:[0,-40]});0!=e&&0!=t&&f.marker([e,t],{icon:i}).addTo(this.map).bindTooltip(n,{permanent:!0}).openTooltip()}},{key:"inputVal",value:function(e){this.field.name=e,this.newMarker&&this.newMarker._popup.setContent(e,{autoPan:!1})}},{key:"regresh",value:function(){this.map.invalidateSize()}},{key:"reset",value:function(){this.map&&(this.map.off(),this.map.remove())}}]),n}(d.a)).\u0275fac=function(e){return new(e||s)(b.Lb(p.a),b.Lb(m.a),b.Lb(h.nb),b.Lb(v.a),b.Lb(h.pb),b.Lb(g.n))},s.\u0275cmp=b.Fb({type:s,selectors:[["app-field-form"]],features:[b.vb],decls:26,vars:2,consts:[["slot","start"],["color","dark",3,"click"],["name","arrow-back"],[3,"ngSubmit","keyup"],[1,"info"],[1,"sug"],["position","floating"],["type","text","name","name",3,"value","input"],[2,"color","red","padding-top","0.2rem"],["id","mapId2",2,"min-width","100%","min-height","400px !important"],[1,"desc"],["expand","block",3,"click"]],template:function(e,t){1&e&&(b.Qb(0,"ion-header"),b.Qb(1,"ion-toolbar"),b.Qb(2,"ion-title"),b.vc(3,"Cancha"),b.Pb(),b.Qb(4,"ion-buttons",0),b.Qb(5,"ion-button",1),b.Yb("click",(function(){return t.close()})),b.Mb(6,"ion-icon",2),b.Pb(),b.Pb(),b.Pb(),b.Pb(),b.Qb(7,"ion-content"),b.Qb(8,"form",3),b.Yb("ngSubmit",(function(){return t.submit()}))("keyup",(function(){return t.modelField.errorsForm.clear()})),b.Qb(9,"div",4),b.vc(10," Ingrese un nombre para identificar la cancha "),b.Qb(11,"span",5),b.vc(12," (Recomendamos el NOMBRE DEL EQUIPO que utiliza la cancha o el NOMBRE DEL LUGAR donde se encuentra ubicado)"),b.Pb(),b.vc(13,", despu\xe9s seleccione la ubicaci\xf3n en el mapa. "),b.Pb(),b.Qb(14,"ion-item"),b.Qb(15,"ion-label",6),b.vc(16,"Nombre"),b.Pb(),b.Qb(17,"ion-input",7),b.Yb("input",(function(e){return t.inputVal(e.target.value)})),b.Pb(),b.Pb(),b.Qb(18,"div",8),b.vc(19),b.Pb(),b.Mb(20,"br"),b.Mb(21,"div",9),b.Qb(22,"div",10),b.vc(23," Mant\xe9n presionado la ubicaci\xf3n en el mapa para a\xf1adir la ubicaci\xf3n. "),b.Pb(),b.Qb(24,"ion-button",11),b.Yb("click",(function(){return t.submit()})),b.vc(25,"Guardar"),b.Pb(),b.Pb(),b.Pb()),2&e&&(b.yb(17),b.gc("value",t.field.name),b.yb(2),b.wc(t.modelField.errorsForm.get("name")))},directives:[h.x,h.jb,h.hb,h.j,h.i,h.y,h.r,y.i,y.e,y.f,h.D,h.G,h.C,h.vb],styles:["#mapId[_ngcontent-%COMP%], #mapId2[_ngcontent-%COMP%]{min-width:100%!important;min-height:300px!important}.desc[_ngcontent-%COMP%]{margin:10px}.info[_ngcontent-%COMP%]{color:#babdbf;margin:15px}.sug[_ngcontent-%COMP%]{color:#727475}"]}),s),w=r("rLe3"),P=r("2Rin"),F=r("y/q6");function M(e,t){if(1&e){var n=b.Rb();b.Qb(0,"ion-button",3),b.Yb("click",(function(e){b.oc(n);var t=b.ac(2).$implicit;return b.ac().showEdit(t,e)})),b.Mb(1,"ion-icon",12),b.Pb()}}function Q(e,t){if(1&e){var n=b.Rb();b.Qb(0,"ion-button",3),b.Yb("click",(function(e){b.oc(n);var t=b.ac(2).$implicit;return b.ac().confirmDelete(t,e)})),b.Mb(1,"ion-icon",13),b.Pb()}}function C(e,t){if(1&e&&(b.Qb(0,"ion-buttons",10),b.uc(1,M,2,0,"ion-button",11),b.uc(2,Q,2,0,"ion-button",11),b.Pb()),2&e){var n=b.ac().$implicit,i=b.ac();b.yb(1),b.gc("ngIf",!n.team_id),b.yb(1),b.gc("ngIf",i.authUser.isAdmin())}}function j(e,t){if(1&e){var n=b.Rb();b.Qb(0,"ion-item",3),b.Yb("click",(function(){b.oc(n);var e=t.$implicit;return b.ac().dismiss(e)})),b.Qb(1,"label"),b.vc(2),b.Pb(),b.uc(3,C,3,2,"ion-buttons",9),b.Pb()}if(2&e){var i=t.$implicit,o=b.ac();b.yb(2),b.wc(i.name),b.yb(1),b.gc("ngIf",o.canEdit)}}function O(e,t){1&e&&(b.Qb(0,"ion-item"),b.Qb(1,"label"),b.vc(2,"No se han encontrado registros"),b.Pb(),b.Pb())}var L,S=((L=function(t){o(r,t);var n=a(r);function r(e,t,i,o,a,s,c,d,f){var b;return l(this,r),(b=n.call(this,s,c)).requestService=e,b.dialogService=t,b.modalController=i,b.utilArray=o,b.util=a,b.viewCtrl=c,b.dialog=d,b.authUser=f,b.fields=[],b.oldFields=[],b.canEdit=!1,b.modelField=new u.a("Field",e),b}return i(r,[{key:"ngOnInit",value:function(){this.util.setScript("https://maps.googleapis.com/maps/api/js?key=AIzaSyA_uVKWprjIgPURNhl1v9zzTPLQJIBdi6I"),this.init()}},{key:"init",value:function(){return Object(c.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dialogService.loadingProgres();case 2:this.modelField.api_function("pageAllFields").subscribe((function(e){"success"==e.status&&(t.fields=e.data,t.oldFields=t.fields),t.dialogService.dimissLoaging()}),(function(e){t.dialogService.dimissLoaging(),t.dialogService.showToast("Error al obtener Campos","","warning")}));case 3:case"end":return e.stop()}}),e,this)})))}},{key:"add",value:function(){return Object(c.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.modalController.create({component:k});case 2:return(t=e.sent).onDidDismiss().then((function(e){e.data&&e.data.field&&n.utilArray.listAddFirst(n.fields,e.data.field)})),e.next=6,t.present();case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"filterField",value:function(t){var n=t.target.value;n.length<=0?this.fields=this.oldFields:(this.fields=e(this.oldFields),this.fields=this.fields.filter((function(e){return e.name.toUpperCase().includes(n.toUpperCase())})))}},{key:"cancelFilter",value:function(e){this.fields=this.oldFields}},{key:"dismiss",value:function(e){this.viewCtrl.dismiss({field:e})}},{key:"close",value:function(){this.viewCtrl.dismiss()}},{key:"confirmDelete",value:function(e,t){var n=this;t.stopPropagation(),this.dialog.presentAlertConfirm("Confirmar","Estas seguro de eliminar esta cancha",(function(t){n.delete(e)}))}},{key:"delete",value:function(e){var t=this;this.modelField.api_delete(e.id).subscribe((function(n){console.log(n),"success"==n.status&&(t.dialog.showToast("Cancha Eliminada",null,"success"),t.utilArray.listDelete(t.fields,e.id))}))}},{key:"showEdit",value:function(e,t){return Object(c.b)(this,void 0,void 0,regeneratorRuntime.mark((function n(){var i,o=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("showEdit"),t.stopPropagation(),n.next=3,this.modalController.create({component:k,componentProps:{id:e.id}});case 3:return(i=n.sent).onDidDismiss().then((function(e){if(e.data&&e.data.field){var t=e.data.field;o.utilArray.listUpdate(o.fields,t.id,t)}})),n.next=7,i.present();case 7:return n.abrupt("return",n.sent);case 8:case"end":return n.stop()}}),n,this)})))}}]),r}(d.a)).\u0275fac=function(e){return new(e||L)(b.Lb(p.a),b.Lb(m.a),b.Lb(h.nb),b.Lb(w.a),b.Lb(P.a),b.Lb(g.n),b.Lb(h.nb),b.Lb(m.a),b.Lb(F.a))},L.\u0275cmp=b.Fb({type:L,selectors:[["app-list-fields"]],features:[b.vb],decls:16,vars:2,consts:[["slot","start"],["defaultHref","/home/teams"],["slot","secondary"],[3,"click"],["name","create-outline"],["name","add-outline"],["placeholder","Filtrar Canchas","debounce","500",3,"keyup","ionClear"],[3,"click",4,"ngFor","ngForOf"],[4,"ngIf"],["slot","end",4,"ngIf"],["slot","end"],[3,"click",4,"ngIf"],["slot","icon-only","name","create-outline"],["name","trash-outline"]],template:function(e,t){1&e&&(b.Qb(0,"ion-header"),b.Qb(1,"ion-toolbar"),b.Qb(2,"ion-title"),b.vc(3,"Campos"),b.Pb(),b.Qb(4,"ion-buttons",0),b.Mb(5,"ion-back-button",1),b.Pb(),b.Qb(6,"ion-buttons",2),b.Qb(7,"ion-button",3),b.Yb("click",(function(){return t.canEdit=!t.canEdit})),b.Mb(8,"ion-icon",4),b.Pb(),b.Qb(9,"ion-button",3),b.Yb("click",(function(){return t.add()})),b.Mb(10,"ion-icon",5),b.Pb(),b.Pb(),b.Pb(),b.Pb(),b.Qb(11,"ion-content"),b.Qb(12,"ion-searchbar",6),b.Yb("keyup",(function(e){return t.filterField(e)}))("ionClear",(function(e){return t.cancelFilter(e)})),b.Pb(),b.Qb(13,"ion-list"),b.uc(14,j,4,2,"ion-item",7),b.uc(15,O,3,0,"ion-item",8),b.Pb(),b.Pb()),2&e&&(b.yb(14),b.gc("ngForOf",t.fields),b.yb(1),b.gc("ngIf",0==t.fields.length))},directives:[h.x,h.jb,h.hb,h.j,h.f,h.g,h.i,h.y,h.r,h.T,h.vb,h.H,g.k,g.l,h.D],styles:[""]}),L)}}])}();