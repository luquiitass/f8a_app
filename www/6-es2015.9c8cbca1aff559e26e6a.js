(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{fSJy:function(i,t,e){"use strict";e.d(t,"a",(function(){return C}));var n=e("mrSG"),s=e("8xVP"),o=e("9suA"),a=e("4R65"),l=e("fXoL"),r=e("G/jy"),c=e("vuFD"),d=e("TEn/"),b=e("6/gD"),h=e("ofXK"),u=e("3Pt+");let p=(()=>{class i extends o.a{constructor(i,t,e,n,o,a){super(a,e),this.request=i,this.dialogService=t,this.viewCtrl=e,this.photoService=n,this.newMarker=null,this.modelField=new s.a("Field",i),this.id=o.get("id")}initObject(){console.log("initObject"),this.field={name:"",lat:-27.603857971720405,lng:-55.323644024643414},navigator.geolocation&&navigator.geolocation.getCurrentPosition(i=>{this.field.lat=i.coords.latitude,this.field.lng=i.coords.longitude,console.log("current pos",i)},i=>{console.error(i)}),this.id?this.modelField.api_find(this.id).subscribe(i=>{console.log("load field",i),"success"==i.status&&(this.field=i.Field,this.leafletMap(),this.addNewMarker())}):this.leafletMap()}submit(){this.field.id?this.modelField.api_update(this.field).subscribe(i=>{var t;"success"==i.status&&(this.dialogService.showToast(null!==(t=i.msjSuccess)&&void 0!==t?t:"Registrado"),this.dismiss(i.Field))}):this.modelField.api_create(this.field).subscribe(i=>{var t;"success"==i.status&&(this.dialogService.showToast(null!==(t=i.msjSuccess)&&void 0!==t?t:"Registrado"),this.dismiss(i.Field))})}dismiss(i){this.viewCtrl.dismiss({field:i})}close(){this.viewCtrl.dismiss()}leafletMap(){this.reset(),this.map=a.map("mapId2"),this.map.on("load",()=>{console.log("load map"),setTimeout(()=>{console.log("refresh"),this.regresh()},1e3)}),this.map.setView([this.field.lat,this.field.lng],11),a.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"futbol8alem.com",id:"mapbox/streets-v11"}).addTo(this.map),this.map.on("contextmenu",i=>{console.log("rightClick",i),this.field.lat=i.latlng.lat,this.field.lng=i.latlng.lng,this.addNewMarker()}),this.loadFields()}addNewMarker(){this.newMarker&&this.map.removeLayer(this.newMarker);const i=a.divIcon({className:"my-custom-pin",iconAnchor:[0,24],labelAnchor:[-6,0],popupAnchor:[0,-36],html:'<span style="\n      background-color: #35da7f;\n      width: 2rem;\n      height: 2rem;\n      display: block;\n      left: -1.5rem;\n      top: -1.5rem;\n      position: relative;\n      border-radius: 3rem 3rem 0;\n      transform: rotate(45deg);\n      border: 1px solid #FFFFFF" />'});this.newMarker=a.marker([this.field.lat,this.field.lng],{draggable:!0,alt:"Nueva Cancha",shadowPane:"Pane",icon:i,title:"Arrastra bara canbiar la ubicaci\xf3n."}).addTo(this.map),this.newMarker.on("dragend",i=>{var t=i.target,e=t.getLatLng();this.field.lat=e.lat,this.field.lng=e.lng,t.openPopup(),console.log("change pos",this.field)}),this.newMarker.bindPopup(this.field.name,{autoPan:!1}).openPopup()}loadFields(){return Object(n.b)(this,void 0,void 0,(function*(){this.id||this.modelField.api_function("markers").subscribe(i=>{"success"==i.status&&i.data&&i.data.forEach(i=>{this.addMarker(parseFloat(i.lat),parseFloat(i.lng),i.name)}),this.map.setView([this.field.lat,this.field.lng],11)},i=>{})}))}addMarker(i,t,e){var n=a.icon({iconUrl:"http://icons.iconseeker.com/png/fullsize/sport-fields/football-field.png",iconSize:[30,40],iconAnchor:[15,40],shadowSize:[35,50],shadowAnchor:[0,55],popupAnchor:[0,-40]});0!=i&&0!=t&&a.marker([i,t],{icon:n}).addTo(this.map).bindTooltip(e,{permanent:!0}).openTooltip()}inputVal(i){this.field.name=i,this.newMarker&&this.newMarker._popup.setContent(i,{autoPan:!1})}regresh(){this.map.invalidateSize()}reset(){this.map&&(this.map.off(),this.map.remove())}}return i.\u0275fac=function(t){return new(t||i)(l.Lb(r.a),l.Lb(c.a),l.Lb(d.nb),l.Lb(b.a),l.Lb(d.pb),l.Lb(h.n))},i.\u0275cmp=l.Fb({type:i,selectors:[["app-field-form"]],features:[l.vb],decls:26,vars:2,consts:[["slot","start"],["color","dark",3,"click"],["name","arrow-back"],[3,"ngSubmit","keyup"],[1,"info"],[1,"sug"],["position","floating"],["type","text","name","name",3,"value","input"],[2,"color","red","padding-top","0.2rem"],["id","mapId2",2,"min-width","100%","min-height","400px !important"],[1,"desc"],["expand","block",3,"click"]],template:function(i,t){1&i&&(l.Qb(0,"ion-header"),l.Qb(1,"ion-toolbar"),l.Qb(2,"ion-title"),l.vc(3,"Cancha"),l.Pb(),l.Qb(4,"ion-buttons",0),l.Qb(5,"ion-button",1),l.Yb("click",(function(){return t.close()})),l.Mb(6,"ion-icon",2),l.Pb(),l.Pb(),l.Pb(),l.Pb(),l.Qb(7,"ion-content"),l.Qb(8,"form",3),l.Yb("ngSubmit",(function(){return t.submit()}))("keyup",(function(){return t.modelField.errorsForm.clear()})),l.Qb(9,"div",4),l.vc(10," Ingrese un nombre para identificar la cancha "),l.Qb(11,"span",5),l.vc(12," (Recomendamos el NOMBRE DEL EQUIPO que utiliza la cancha o el NOMBRE DEL LUGAR donde se encuentra ubicado)"),l.Pb(),l.vc(13,", despu\xe9s seleccione la ubicaci\xf3n en el mapa. "),l.Pb(),l.Qb(14,"ion-item"),l.Qb(15,"ion-label",6),l.vc(16,"Nombre"),l.Pb(),l.Qb(17,"ion-input",7),l.Yb("input",(function(i){return t.inputVal(i.target.value)})),l.Pb(),l.Pb(),l.Qb(18,"div",8),l.vc(19),l.Pb(),l.Mb(20,"br"),l.Mb(21,"div",9),l.Qb(22,"div",10),l.vc(23," Mant\xe9n presionado la ubicaci\xf3n en el mapa para a\xf1adir la ubicaci\xf3n. "),l.Pb(),l.Qb(24,"ion-button",11),l.Yb("click",(function(){return t.submit()})),l.vc(25,"Guardar"),l.Pb(),l.Pb(),l.Pb()),2&i&&(l.yb(17),l.gc("value",t.field.name),l.yb(2),l.wc(t.modelField.errorsForm.get("name")))},directives:[d.x,d.jb,d.hb,d.j,d.i,d.y,d.r,u.i,u.e,u.f,d.D,d.G,d.C,d.vb],styles:["#mapId[_ngcontent-%COMP%], #mapId2[_ngcontent-%COMP%]{min-width:100%!important;min-height:300px!important}.desc[_ngcontent-%COMP%]{margin:10px}.info[_ngcontent-%COMP%]{color:#babdbf;margin:15px}.sug[_ngcontent-%COMP%]{color:#727475}"]}),i})();var m=e("qsXW"),f=e("rLe3"),g=e("2Rin"),v=e("y/q6"),P=e("EbHZ");function k(i,t){if(1&i){const i=l.Rb();l.Qb(0,"ion-button",4),l.Yb("click",(function(){l.oc(i);const t=l.ac();return t.canEdit=!t.canEdit})),l.Mb(1,"ion-icon",11),l.Pb()}}function w(i,t){if(1&i){const i=l.Rb();l.Qb(0,"ion-segment",12),l.Yb("ionChange",(function(t){return l.oc(i),l.ac().segmentChanged(t)})),l.Qb(1,"ion-segment-button",13),l.Qb(2,"ion-label"),l.vc(3,"Lista"),l.Pb(),l.Pb(),l.Qb(4,"ion-segment-button",14),l.Qb(5,"ion-label"),l.vc(6,"Mapa"),l.Pb(),l.Pb(),l.Pb()}if(2&i){const i=l.ac();l.gc("value",i.segment_select)}}function y(i,t){1&i&&(l.Qb(0,"ion-item"),l.Qb(1,"label"),l.vc(2,"No se han encontrado registros"),l.Pb(),l.Pb())}function F(i,t){if(1&i){const i=l.Rb();l.Qb(0,"ion-button",4),l.Yb("click",(function(t){l.oc(i);const e=l.ac(2).$implicit;return l.ac().showEdit(e,t)})),l.Mb(1,"ion-icon",17),l.Pb()}}function Q(i,t){if(1&i){const i=l.Rb();l.Qb(0,"ion-button",4),l.Yb("click",(function(t){l.oc(i);const e=l.ac(2).$implicit;return l.ac().confirmDelete(e,t)})),l.Mb(1,"ion-icon",18),l.Pb()}}function L(i,t){if(1&i&&(l.Qb(0,"ion-buttons",16),l.uc(1,F,2,0,"ion-button",3),l.uc(2,Q,2,0,"ion-button",3),l.Pb()),2&i){const i=l.ac().$implicit,t=l.ac();l.yb(1),l.gc("ngIf",!i.team_id),l.yb(1),l.gc("ngIf",t.authUser.isAdmin())}}function M(i,t){if(1&i){const i=l.Rb();l.Qb(0,"ion-item",4),l.Yb("click",(function(){l.oc(i);const e=t.$implicit;return l.ac().dismiss(e)})),l.Qb(1,"label",4),l.Yb("click",(function(e){l.oc(i);const n=t.$implicit;return l.ac().show(n,e)})),l.vc(2),l.Pb(),l.uc(3,L,3,2,"ion-buttons",15),l.Pb()}if(2&i){const i=t.$implicit,e=l.ac();l.yb(2),l.wc(i.name),l.yb(1),l.gc("ngIf",e.canEdit)}}let C=(()=>{class i extends o.a{constructor(i,t,e,n,o,a,l,r,c,d){super(a,l),this.requestService=i,this.dialogService=t,this.modalController=e,this.utilArray=n,this.util=o,this.viewCtrl=l,this.dialog=r,this.authUser=c,this.transfDat=d,this.segment_select="list",this.fields=[],this.oldFields=[],this.markers=[],this.canEdit=!1,this.isSelect=!1,this.modelField=new s.a("Field",i),this.isSelect=d.getData("isSelect"),d.clear()}ngOnInit(){this.init()}init(){return Object(n.b)(this,void 0,void 0,(function*(){yield this.dialogService.loadingProgres(),this.modelField.api_function("pageAllFields").subscribe(i=>{"success"==i.status&&(this.fields=i.data,this.oldFields=this.fields),this.leafletMap(),this.dialogService.dimissLoaging()},i=>{this.dialogService.dimissLoaging(),this.dialogService.showToast("Error al obtener Campos","","warning")})}))}add(){return Object(n.b)(this,void 0,void 0,(function*(){const i=yield this.modalController.create({component:p});return i.onDidDismiss().then(i=>{i.data&&i.data.field&&this.utilArray.listAddFirst(this.fields,i.data.field)}),yield i.present()}))}filterField(i){let t=i.target.value;if(t.length<=0)return this.fields=this.oldFields,void this.loadFields();this.fields=[...this.oldFields],this.fields=this.fields.filter(i=>i.name.toUpperCase().includes(t.toUpperCase())),this.loadFields()}cancelFilter(i){this.fields=this.oldFields}dismiss(i){this.viewCtrl.dismiss({field:i})}close(){this.viewCtrl.dismiss()}confirmDelete(i,t){t.stopPropagation(),this.dialog.presentAlertConfirm("Confirmar","Estas seguro de eliminar esta cancha",t=>{this.delete(i)})}delete(i){this.modelField.api_delete(i.id).subscribe(t=>{console.log(t),"success"==t.status&&(this.dialog.showToast("Cancha Eliminada",null,"success"),this.utilArray.listDelete(this.fields,i.id))})}showEdit(i,t){return Object(n.b)(this,void 0,void 0,(function*(){console.log("showEdit"),t.stopPropagation();const e=yield this.modalController.create({component:p,componentProps:{id:i.id}});return e.onDidDismiss().then(i=>{if(i.data&&i.data.field){const t=i.data.field;this.utilArray.listUpdate(this.fields,t.id,t)}}),yield e.present()}))}show(i,t){return Object(n.b)(this,void 0,void 0,(function*(){if(this.isSelect)return;console.log("show"),t.stopPropagation();const e=yield this.modalController.create({component:m.a,componentProps:{id:i.id}});return e.onDidDismiss().then(i=>{}),yield e.present()}))}segmentChanged(i){this.segment_select=i.detail.value,setTimeout(()=>{this.regresh()},100)}leafletMap(){this.map=a.map("mapId3"),this.map.on("load",()=>{console.log("load map"),setTimeout(()=>{console.log("refresh"),this.regresh()},1e3)}),this.map.setView([-27.603857971720405,-55.323644024643414],11),a.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"futbol8alem.com",id:"mapbox/streets-v11"}).addTo(this.map),this.loadFields()}loadFields(){this.markers.forEach(i=>{this.map&&this.map.removeLayer(i)}),this.markers=[],this.fields.forEach(i=>{this.addMarker(parseFloat(i.lat),parseFloat(i.lng),i.name)}),this.regresh()}addMarker(i,t,e){var n=a.icon({iconUrl:"http://icons.iconseeker.com/png/fullsize/sport-fields/football-field.png",iconSize:[30,40],iconAnchor:[15,40],shadowSize:[35,50],shadowAnchor:[0,55],popupAnchor:[0,-40]});if(0!=i&&0!=t){var s=a.marker([i,t],{icon:n}).addTo(this.map).bindTooltip(e,{permanent:!0}).openTooltip();this.markers.push(s)}}reset(){this.map&&(this.map.off(),this.map.remove())}regresh(){this.map.invalidateSize()}}return i.\u0275fac=function(t){return new(t||i)(l.Lb(r.a),l.Lb(c.a),l.Lb(d.nb),l.Lb(f.a),l.Lb(g.a),l.Lb(h.n),l.Lb(d.nb),l.Lb(c.a),l.Lb(v.a),l.Lb(P.a))},i.\u0275cmp=l.Fb({type:i,selectors:[["app-list-fields"]],features:[l.vb],decls:19,vars:8,consts:[["slot","start"],["defaultHref","/home/teams",3,"click"],["slot","secondary"],[3,"click",4,"ngIf"],[3,"click"],["name","add-outline"],[3,"value","ionChange",4,"ngIf"],["placeholder","Filtrar Canchas","debounce","500",3,"keyup","ionClear"],[4,"ngIf"],[3,"click",4,"ngFor","ngForOf"],["id","mapId3",2,"min-width","100%","min-height","400px !important"],["name","create-outline"],[3,"value","ionChange"],["value","list"],["value","map"],["slot","end",4,"ngIf"],["slot","end"],["slot","icon-only","name","create-outline"],["name","trash-outline"]],template:function(i,t){1&i&&(l.Qb(0,"ion-header"),l.Qb(1,"ion-toolbar"),l.Qb(2,"ion-title"),l.vc(3,"Canchas"),l.Pb(),l.Qb(4,"ion-buttons",0),l.Qb(5,"ion-back-button",1),l.Yb("click",(function(){return t.close()})),l.Pb(),l.Pb(),l.Qb(6,"ion-buttons",2),l.uc(7,k,2,0,"ion-button",3),l.Qb(8,"ion-button",4),l.Yb("click",(function(){return t.add()})),l.Mb(9,"ion-icon",5),l.Pb(),l.Pb(),l.Pb(),l.Pb(),l.Qb(10,"ion-content"),l.uc(11,w,7,1,"ion-segment",6),l.Qb(12,"ion-searchbar",7),l.Yb("keyup",(function(i){return t.filterField(i)}))("ionClear",(function(i){return t.cancelFilter(i)})),l.Pb(),l.uc(13,y,3,0,"ion-item",8),l.Qb(14,"div"),l.Qb(15,"ion-list"),l.uc(16,M,4,2,"ion-item",9),l.Pb(),l.Pb(),l.Qb(17,"div"),l.Mb(18,"div",10),l.Pb(),l.Pb()),2&i&&(l.yb(7),l.gc("ngIf","list"==t.segment_select),l.yb(4),l.gc("ngIf",!t.isSelect),l.yb(2),l.gc("ngIf",0==t.fields.length),l.yb(1),l.tc("display","list"==t.segment_select?"block":"none"),l.yb(2),l.gc("ngForOf",t.fields),l.yb(1),l.tc("display","map"!=t.segment_select||t.isSelect?"none":"block"))},directives:[d.x,d.jb,d.hb,d.j,d.f,d.g,h.l,d.i,d.y,d.r,d.T,d.vb,d.H,h.k,d.U,d.ub,d.V,d.G,d.D],styles:[""]}),i})()},rLe3:function(i,t,e){"use strict";e.d(t,"a",(function(){return s}));var n=e("fXoL");let s=(()=>{class i{constructor(){}listAddLast(i,t){i.push(t)}listAddFirst(i,t){i.unshift(t)}listUpdate(i,t,e){let n=this.findIndexList(i,t);n>=0&&(i[n]=e)}listDelete(i,t){let e=this.findIndexList(i,t);e>=0&&i.splice(e,1)}findList(i,t){return i.find(i=>i.id===t)}findIndexList(i,t){return i.findIndex(i=>i.id===t)}updateAttribustesObject(i,t,e=[]){console.log("update attributes");for(let n of e)t.hasOwnProperty(n)&&(i[n]=t[n]);return i}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275prov=n.Hb({token:i,factory:i.\u0275fac,providedIn:"root"}),i})()}}]);